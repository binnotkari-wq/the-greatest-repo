# ğŸ§© Fedora Kinoite / Silverblue â€” Virtualisation sans rpm-ostree

> **Objectif :** Faire tourner des machines virtuelles avec QEMU + libvirt dans Fedora **Kinoite / Silverblue**, sans casser lâ€™OSTree, sans `sudo`, et sans passer par Toolbox.

---

## ğŸ§± Principe gÃ©nÃ©ral

Les distributions **immuables Fedora** (Kinoite, Silverblue, Sericea, etc.) ne permettent pas dâ€™installer directement des paquets systÃ¨mes (`libvirt`, `qemu-kvm`, etc.) sans `rpm-ostree overlay`.

Mais grÃ¢ce Ã  **Virt-Manager en Flatpak** et son extension QEMU, il est possible dâ€™obtenir une pile de virtualisation complÃ¨te **en espace utilisateur** :

- **Virt-Manager (GUI)** â†’ application Flatpak (`org.virt_manager.virt-manager`)
- **QEMU + libvirt** â†’ extension Flatpak (`org.virt_manager.virt_manager.Extension.Qemu`)
- Aucun accÃ¨s root requis
- Aucun impact sur le systÃ¨me de base (`/usr` inchangÃ©)

---

## âš™ï¸ Installation

### 1. Installer Virt-Manager (Flatpak)
```bash
flatpak install flathub org.virt_manager.virt-manager

2. Installer le module QEMU pour lâ€™exÃ©cution des VM

flatpak install flathub org.virt_manager.virt_manager.Extension.Qemu

    ğŸ’¡ Ce module contient virtqemud, virtlogd, virtstoraged et les binaires QEMU nÃ©cessaires, exÃ©cutÃ©s dans le sandbox.

ğŸª„ Forcer la liaison entre les deux composants

Sur certaines installations, Virt-Manager ne dÃ©tecte pas automatiquement lâ€™extension.
Dans ce cas :

flatpak override --user \
  --add-extensions=org.virt_manager.virt_manager.Extension.Qemu=org.virt_manager.virt-manager

Puis relancer :

flatpak run org.virt_manager.virt-manager//stable

ğŸ–¥ï¸ CrÃ©ation dâ€™une machine virtuelle

    Lancer Virt-Manager :

    flatpak run org.virt_manager.virt-manager//stable

    CrÃ©er une connexion utilisateur :

        Type : QEMU/KVM â€“ Session utilisateur

        URI : qemu:///session

    Ajouter un nouvel hÃ´te virtuel â†’ choisir lâ€™image ISO Ã  installer.

âš ï¸ ProblÃ¨me frÃ©quent : ISO non lisible (/run/user/.../doc/...)
SymptÃ´me :

    Failed to get "consistent read" lock: Input/output error

Cause :

Lâ€™ISO provient dâ€™un disque externe ou dâ€™un sÃ©lecteur de fichiers Flatpak â†’ accÃ¨s indirect via xdg-document-portal.
Solution :

Copier le fichier ISO dans ton $HOME, puis accorder Ã  Virt-Manager lâ€™accÃ¨s :

mkdir -p ~/VMs/iso
cp /media/mon_disque/slitaz.iso ~/VMs/iso/
flatpak override --user --filesystem=$HOME/VMs org.virt_manager.virt-manager

Relancer Virt-Manager et sÃ©lectionner lâ€™ISO depuis ~/VMs/iso.
ğŸŒ RÃ©seau utilisateur

Le mode â€œsession utilisateurâ€ de QEMU utilise un rÃ©seau virtio user-mode NAT intÃ©grÃ©.
Aucune interface virbr0 systÃ¨me nâ€™est nÃ©cessaire.

La VM aura accÃ¨s Ã  Internet, mais ne sera pas directement accessible depuis le rÃ©seau local.

    Pour un rÃ©seau â€œbridgeâ€ ou â€œvirtioâ€ avancÃ©, il faut passer Ã  une instance qemu:///system (donc installation via rpm-ostree ou Podman).

ğŸ§¾ VÃ©rifications utiles

Lister les binaires montÃ©s dans le sandbox :

flatpak run --command=ls org.virt_manager.virt-manager /app/bin/

Lister les VMs disponibles :

virsh -c qemu:///session list

ğŸ§© Avantages de cette mÃ©thode
Aspect	Description
ğŸ”’ SÃ©curitÃ©	ExÃ©cution en sandbox, aucun accÃ¨s root
ğŸ§± AtomicitÃ©	SystÃ¨me Kinoite immuable, OSTree intact
ğŸ” RÃ©versibilitÃ©	Pas de modification persistante du systÃ¨me
ğŸ§° SimplicitÃ©	Une seule commande Flatpak pour tout installer
âš™ï¸ Usage	Suffisant pour tests, bidouilles, dÃ©veloppement
ğŸ”— RÃ©fÃ©rence principale

Source :
Zihad â€” Virt-Manager in Fedora Silverblue / Kinoite (2024)
ğŸ’¬ Notes pratiques

    Le service libvirtd tourne en espace utilisateur, donc aucun systemctl nâ€™est requis.

    Les images de disques sont stockÃ©es sous :

~/.local/share/libvirt/images/

Pour effacer proprement toutes les VMs :

    virsh -c qemu:///session undefine --domain <nom_VM> --remove-all-storage

âœï¸ Auteur : BenoÃ®t D.
ğŸ§  Assistance technique : ChatGPT (GPT-5)
ğŸ“… Mise Ã  jour : Novembre 2025
